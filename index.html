<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Futures Sniper Pro | åˆçº¦ç‹™å‡»æ‰‹æŒ‡æŒ¥ä¸­å¿ƒ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0b1120; color: #cbd5e1; font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .input-dark { background-color: #1e293b; border: 1px solid #334155; color: white; transition: all 0.2s; }
        .input-dark:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); outline: none; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
        .pulse-active { animation: pulse-green 2s infinite; }
        select optgroup { background: #0f172a; color: #94a3b8; font-style: italic; }
        select option { background: #1e293b; color: white; font-style: normal; padding: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- å›¾æ ‡å®šä¹‰ ---
        const Icons = {
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Calculator: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Brain: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            ExternalLink: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            ShieldAlert: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            PenTool: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>,
            Briefcase: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>,
            Clipboard: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            Globe: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Activity: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
        };

        // --- ä¿®å¤ç‰ˆï¼šTicker Tape (èµ°é©¬ç¯æ¨¡å¼) ---
        const TickerTape = () => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (!containerRef.current) return;
                containerRef.current.innerHTML = ""; 
                
                const script = document.createElement('script');
                script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js';
                script.async = true;
                script.type = 'text/javascript';
                script.innerHTML = JSON.stringify({
                    "symbols": [
                        { "proName": "CAPITALCOM:DXY", "title": "ç¾å…ƒæŒ‡æ•°" },
                        { "proName": "FOREXCOM:NAS100", "title": "çº³æ–¯è¾¾å…‹" },
                        { "proName": "FOREXCOM:SPX500", "title": "æ ‡æ™®500" },
                        { "proName": "OANDA:XAUUSD", "title": "é»„é‡‘" },
                        { "proName": "CRYPTOCAP:BTC.D", "title": "BTC å æ¯”" },
                        { "proName": "CRYPTOCAP:USDT.D", "title": "USDT å æ¯”" }
                    ],
                    "showSymbolLogo": true,
                    "colorTheme": "dark",
                    "isTransparent": false,
                    "displayMode": "adaptive", // è‡ªåŠ¨èµ°é©¬ç¯æ¨¡å¼
                    "locale": "zh_CN"
                });
                
                const widgetContainer = document.createElement('div');
                widgetContainer.className = 'tradingview-widget-container__widget';
                containerRef.current.appendChild(widgetContainer);
                containerRef.current.appendChild(script);
            }, []);

            return (
                <div className="tradingview-widget-container w-full h-[72px] bg-slate-900 overflow-hidden" ref={containerRef}></div>
            );
        };

        // --- ç´§å‡‘ç‰ˆï¼šææ…ŒæŒ‡æ•°å¾½ç«  (é›†æˆåœ¨Nav) ---
        const FearGreedBadge = () => {
            const [data, setData] = useState(null);
            useEffect(() => {
                fetch('https://api.alternative.me/fng/?limit=1')
                    .then(res => res.json()).then(res => setData(res.data[0]))
                    .catch(err => console.error(err));
            }, []);

            if (!data) return <span className="text-slate-500 text-xs">F&G: Loading...</span>;
            
            const val = parseInt(data.value);
            let color = "text-yellow-400";
            if (val <= 25) color = "text-green-400"; // ææ…Œä¹°å…¥
            else if (val >= 75) color = "text-red-400"; // è´ªå©ªå–å‡º

            return (
                <div className="flex items-center gap-2 bg-slate-800 border border-slate-700 px-3 py-1.5 rounded-lg text-xs" title="ææ…Œè´ªå©ªæŒ‡æ•°">
                    <Icons.Activity />
                    <span className="text-slate-400">æƒ…ç»ª:</span>
                    <span className={`font-bold ${color}`}>{data.value} ({data.value_classification})</span>
                </div>
            );
        };

        const SessionClock = () => {
            const [time, setTime] = useState(new Date());
            useEffect(() => { const timer = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(timer); }, []);
            const hour = time.getUTCHours();
            const isAsia = hour >= 0 && hour < 9;
            const isLondon = hour >= 7 && hour < 16;
            const isNY = hour >= 12 && hour < 21;
            const formatTime = (date) => date.toLocaleTimeString('zh-CN', { hour12: false });
            return (
                <div className="flex items-center gap-3 bg-slate-900 border border-slate-700 px-3 py-1.5 rounded-lg text-xs">
                    <div className="flex items-center gap-1 text-slate-400 font-mono"><Icons.Clock /> {formatTime(time)} (UTC)</div>
                    <div className="h-4 w-[1px] bg-slate-700"></div>
                    <div className="flex gap-2 hidden md:flex">
                        <span className={`px-1.5 rounded ${isAsia ? 'bg-yellow-900 text-yellow-300 font-bold pulse-active' : 'text-slate-600'}`}>äºšæ´²</span>
                        <span className={`px-1.5 rounded ${isLondon ? 'bg-blue-900 text-blue-300 font-bold pulse-active' : 'text-slate-600'}`}>ä¼¦æ•¦</span>
                        <span className={`px-1.5 rounded ${isNY ? 'bg-green-900 text-green-300 font-bold pulse-active' : 'text-slate-600'}`}>çº½çº¦</span>
                    </div>
                </div>
            );
        };

        const Toolkit = () => {
            const [high, setHigh] = useState(""); const [low, setLow] = useState(""); const [close, setClose] = useState(""); const [pivots, setPivots] = useState(null);
            const [position, setPosition] = useState(""); const [rate, setRate] = useState("0.01"); const [fee, setFee] = useState(null);
            const [price1, setPrice1] = useState(""); const [amt1, setAmt1] = useState(""); const [price2, setPrice2] = useState(""); const [amt2, setAmt2] = useState(""); const [avgPrice, setAvgPrice] = useState(null);

            const calcPivot = () => { const h=parseFloat(high),l=parseFloat(low),c=parseFloat(close); if(!h||!l||!c)return; const p=(h+l+c)/3; setPivots({p:p.toFixed(2),r1:(2*p-l).toFixed(2),s1:(2*p-h).toFixed(2),r2:(p+(h-l)).toFixed(2),s2:(p-(h-l)).toFixed(2)}); };
            const calcFee = () => { const p=parseFloat(position),r=parseFloat(rate); if(!p||isNaN(r))return; const daily=p*(r/100)*3; setFee({perTime:(p*(r/100)).toFixed(2),daily:daily.toFixed(2),monthly:(daily*30).toFixed(2)}); };
            const calcAvg = () => { const p1=parseFloat(price1),a1=parseFloat(amt1),p2=parseFloat(price2),a2=parseFloat(amt2); if(!p1||!a1||!p2||!a2)return; setAvgPrice(((p1*a1+p2*a2)/(a1+a2)).toFixed(2)); };

            return (
                <div className="space-y-6 animate-fade-in p-1">
                    <div className="bg-slate-700/30 p-3 rounded border border-slate-700 space-y-3">
                        <h4 className="text-purple-400 font-bold text-sm flex items-center gap-2"><Icons.Globe /> å®è§‚å…³è”åº¦é€ŸæŸ¥</h4>
                        <div className="grid grid-cols-1 gap-2 text-xs">
                            <div className="bg-slate-800 p-2 rounded border-l-2 border-red-500 flex justify-between"><span>ğŸ‡ºğŸ‡¸ DXY æ¶¨</span><span className="text-slate-400">BTC <span className="text-red-400 font-bold">â†“ è·Œ</span></span></div>
                            <div className="bg-slate-800 p-2 rounded border-l-2 border-green-500 flex justify-between"><span>ğŸ–¥ï¸ NAS100 æ¶¨</span><span className="text-slate-400">BTC <span className="text-green-400 font-bold">â†‘ æ¶¨</span></span></div>
                            <div className="bg-slate-800 p-2 rounded border-l-2 border-yellow-500 flex justify-between"><span>ğŸª™ é»„é‡‘ æ¶¨</span><span className="text-slate-400">BTC <span className="text-yellow-400 font-bold">~ è”åŠ¨</span></span></div>
                        </div>
                    </div>
                    
                    <div className="bg-slate-700/30 p-3 rounded border border-slate-700">
                        <h4 className="text-blue-400 font-bold text-sm mb-3 flex items-center gap-2"><Icons.Target /> æ¢è½´ç‚¹ (Pivot)</h4>
                        <div className="grid grid-cols-3 gap-2 mb-2">
                            <input type="number" placeholder="æ˜¨é«˜" value={high} onChange={e=>setHigh(e.target.value)} className="input-dark p-1.5 rounded text-xs w-full" />
                            <input type="number" placeholder="æ˜¨ä½" value={low} onChange={e=>setLow(e.target.value)} className="input-dark p-1.5 rounded text-xs w-full" />
                            <input type="number" placeholder="æ˜¨æ”¶" value={close} onChange={e=>setClose(e.target.value)} className="input-dark p-1.5 rounded text-xs w-full" />
                        </div>
                        <button onClick={calcPivot} className="w-full bg-blue-600 hover:bg-blue-500 text-white py-1 rounded text-xs mb-3 transition">è®¡ç®—</button>
                        {pivots && <div className="grid grid-cols-2 gap-2 text-xs text-center"><div className="bg-red-900/30 p-1 rounded border border-red-900/50 text-red-300">R1: {pivots.r1}</div><div className="bg-green-900/30 p-1 rounded border border-green-900/50 text-green-300">S1: {pivots.s1}</div></div>}
                    </div>

                    <div className="grid grid-cols-2 gap-2">
                        <button className="bg-slate-700/30 p-2 rounded text-xs text-slate-300 border border-slate-700 hover:bg-slate-600 transition" onClick={()=>alert('ä½¿ç”¨æ–¹æ³•ï¼š\n1. è¾“å…¥æŒä»“ä»·å€¼ (å¦‚ 50000 U)\n2. è¾“å…¥è´¹ç‡ (å¦‚ 0.01%)\n3. ç‚¹å‡»è®¡ç®—æŸ¥çœ‹æ¯æ—¥/æ¯æœˆæ‰£è´¹ã€‚')}>è´¹ç‡è¯´æ˜</button>
                        <button className="bg-slate-700/30 p-2 rounded text-xs text-slate-300 border border-slate-700 hover:bg-slate-600 transition" onClick={()=>alert('ä½¿ç”¨æ–¹æ³•ï¼š\n1. è¾“å…¥å½“å‰æŒä»“ä»·å’Œæ•°é‡\n2. è¾“å…¥è®¡åˆ’è¡¥ä»“ä»·å’Œæ•°é‡\n3. è®¡ç®—å‡ºæ–°çš„å¹³å‡å…¥åœºä»·ã€‚')}>å‡ä»·è¯´æ˜</button>
                    </div>
                </div>
            );
        };

        const RiskRewardCalc = ({ direction, currentPrice }) => {
            const [entry, setEntry] = useState(currentPrice || 60000); const [sl, setSl] = useState(0); const [tp, setTp] = useState(0);
            const rrRatio = useMemo(() => { if (!entry || !sl || !tp) return 0; const risk = Math.abs(entry - sl); const reward = Math.abs(tp - entry); return risk === 0 ? 0 : (reward / risk).toFixed(2); }, [entry, sl, tp]);
            const isValid = useMemo(() => direction === 'long' ? tp > entry && sl < entry : tp < entry && sl > entry, [direction, tp, sl, entry]);
            return ( <div className="space-y-4 animate-fade-in"><div className="grid grid-cols-3 gap-2"><div><label className="text-xs text-slate-500 block mb-1">å…¥åœº</label><input type="number" value={entry} onChange={e=>setEntry(e.target.value)} className="w-full input-dark p-2 rounded text-sm"/></div><div><label className="text-xs text-slate-500 block mb-1">æ­¢æŸ</label><input type="number" value={sl} onChange={e=>setSl(e.target.value)} className="w-full input-dark p-2 rounded text-sm border-red-900/50"/></div><div><label className="text-xs text-slate-500 block mb-1">æ­¢ç›ˆ</label><input type="number" value={tp} onChange={e=>setTp(e.target.value)} className="w-full input-dark p-2 rounded text-sm border-green-900/50"/></div></div><div className={`p-3 rounded border flex justify-between items-center ${rrRatio >= 2 && isValid ? 'bg-green-900/20 border-green-700' : 'bg-red-900/20 border-red-700'}`}><div className="flex flex-col"><span className="text-xs text-slate-400">ç›ˆäºæ¯”</span><span className="text-xl font-bold">{rrRatio}:1</span></div><div className="text-right text-xs">{rrRatio >= 2 && isValid ? 'âœ… å¯è¡Œ' : 'âŒ ä¸åˆ’ç®—'}</div></div></div> );
        };

        const PositionCalc = ({ direction, score }) => {
            const [equity, setEquity] = useState(10000); const [riskPercent, setRiskPercent] = useState(2); const [entryPrice, setEntryPrice] = useState(60000); const [slPrice, setSlPrice] = useState(0);
            const recRisk = useMemo(() => { if (score >= 900) return { val: 5, label: "Sçº§", color: "text-purple-400" }; if (score >= 800) return { val: 3, label: "Açº§", color: "text-green-400" }; return { val: 1, label: "Bçº§", color: "text-yellow-400" }; }, [score]);
            const result = useMemo(() => { if (!slPrice || !entryPrice || entryPrice === slPrice) return { size: 0 }; const maxLoss = equity * (riskPercent / 100); const diff = Math.abs(entryPrice - slPrice) / entryPrice; return { size: (maxLoss / diff).toFixed(0) }; }, [equity, riskPercent, slPrice, entryPrice]);
            return ( <div className="space-y-4 animate-fade-in"><div className="bg-slate-900 p-2 rounded flex justify-between items-center border border-slate-700"><span className={`text-xs ${recRisk.color}`}>å»ºè®®é£é™©: {recRisk.val}% ({recRisk.label})</span><button onClick={()=>setRiskPercent(recRisk.val)} className="text-xs bg-blue-600 px-2 py-1 rounded">åº”ç”¨</button></div><div className="flex gap-2"><div><label className="text-xs text-slate-500">æœ¬é‡‘</label><input type="number" value={equity} onChange={e=>setEquity(e.target.value)} className="w-full input-dark p-2 rounded"/></div><div><label className="text-xs text-slate-500">é£é™©%</label><input type="number" value={riskPercent} onChange={e=>setRiskPercent(e.target.value)} className="w-full input-dark p-2 rounded"/></div></div><div className="grid grid-cols-2 gap-2"><div><label className="text-xs text-slate-500">å…¥åœº</label><input type="number" value={entryPrice} onChange={e=>setEntryPrice(e.target.value)} className="w-full input-dark p-2 rounded"/></div><div><label className="text-xs text-slate-500">æ­¢æŸ</label><input type="number" value={slPrice} onChange={e=>setSlPrice(e.target.value)} className="w-full input-dark p-2 rounded border-red-900/50"/></div></div><div className="bg-slate-800 p-3 rounded text-center"><div className="text-xs text-slate-400">å»ºè®®å¼€ä»“ä»·å€¼</div><div className="text-xl font-bold text-white">{result.size} U</div></div></div> );
        };

        const BattlePlan = ({ score, rec, symbol, direction }) => {
            const [notes, setNotes] = useState(""); const [entry, setEntry] = useState(""); const [sl, setSl] = useState(""); const [tp, setTp] = useState(""); const [copied, setCopied] = useState(false);
            const generateReport = () => { navigator.clipboard.writeText(`ğŸ¯ ç‹™å‡»æŠ¥å‘Š\n${symbol} (${direction})\nè¯„åˆ†: ${score}\nå…¥åœº: ${entry}\næ­¢æŸ: ${sl}\næ­¢ç›ˆ: ${tp}\né€»è¾‘: ${notes}`); setCopied(true); setTimeout(() => setCopied(false), 2000); };
            return ( <div className="space-y-4 h-full flex flex-col"><div className="bg-slate-700/30 p-3 rounded border border-slate-700"><div className="grid grid-cols-3 gap-2"><input placeholder="å…¥åœº" value={entry} onChange={e=>setEntry(e.target.value)} className="w-full input-dark p-2 text-xs rounded"/><input placeholder="æ­¢æŸ" value={sl} onChange={e=>setSl(e.target.value)} className="w-full input-dark p-2 text-xs rounded border-red-900/50"/><input placeholder="æ­¢ç›ˆ" value={tp} onChange={e=>setTp(e.target.value)} className="w-full input-dark p-2 text-xs rounded border-green-900/50"/></div></div><textarea value={notes} onChange={e=>setNotes(e.target.value)} className="flex-1 w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-slate-300 resize-none outline-none" placeholder="äº¤æ˜“é€»è¾‘..."></textarea><button onClick={generateReport} className={`w-full py-3 rounded font-bold ${copied?'bg-green-600':'bg-blue-600 text-white'}`}>{copied?'å·²å¤åˆ¶':'ç”ŸæˆæŠ¥å‘Š'}</button></div> );
        };

        const App = () => {
            const [symbol, setSymbol] = useState("BINANCE:BTCUSDT.P"); 
            const [direction, setDirection] = useState("long");
            const [activeTab, setActiveTab] = useState("score"); 
            const [scores, setScores] = useState({ trend: { ma99: false, ma_align: false, dow: false }, location: { fib: false, ma_touch: false, vpvr: false }, signal: { divergence: false, pattern: false, oi: false }, macro: { funding: false, fed: false } });
            const weights = { trend: { ma99: 200, ma_align: 100, dow: 80 }, location: { fib: 150, ma_touch: 100, vpvr: 50 }, signal: { divergence: 80, pattern: 60, oi: 60 }, macro: { funding: 40, fed: 80 } };
            const totalScore = useMemo(() => { let total = 0; Object.keys(scores).forEach(c => Object.keys(scores[c]).forEach(k => { if(scores[c][k]) total += weights[c][k] })); return total; }, [scores]);
            const getRec = (score) => { if (score >= 900) return { text: "Sçº§ ä¼ è¯´", action: "é‡ä»“", color: "text-purple-400", border: "border-purple-500" }; if (score >= 800) return { text: "Açº§ ç‹™å‡»", action: "æ ‡å‡†", color: "text-green-400", border: "border-green-500" }; if (score >= 700) return { text: "Bçº§ æ™®é€š", action: "è½»ä»“", color: "text-yellow-400", border: "border-yellow-500" }; return { text: "åƒåœ¾æ—¶é—´", action: "ç©ºä»“", color: "text-red-400", border: "border-red-500" }; };
            const rec = getRec(totalScore);
            const handleCheck = (c, k) => setScores(p => ({...p, [c]: {...p[c], [k]: !p[c][k]}}));

            useEffect(() => {
                const script = document.createElement('script'); script.src = 'https://s3.tradingview.com/tv.js'; script.async = true;
                script.onload = () => { if (window.TradingView) { new window.TradingView.widget({ "width": "100%", "height": 600, "symbol": symbol, "interval": "240", "timezone": "Asia/Shanghai", "theme": "dark", "style": "1", "locale": "zh_CN", "toolbar_bg": "#f1f3f6", "enable_publishing": false, "hide_side_toolbar": false, "allow_symbol_change": true, "container_id": "tradingview_chart", "studies": [ "MASimple@tv-basicstudies", "RSI@tv-basicstudies", "Volume@tv-basicstudies" ], "overrides": { "paneProperties.background": "#0f172a", "paneProperties.vertGridProperties.color": "#1e293b", "paneProperties.horzGridProperties.color": "#1e293b" } }); } };
                document.getElementById('tradingview_chart').innerHTML = ''; document.body.appendChild(script);
            }, [symbol]);

            return (
                <div className="container mx-auto p-2 lg:p-4 max-w-7xl min-h-screen flex flex-col">
                    
                    {/* Ticker Tape (è‡ªåŠ¨èµ°é©¬ç¯) */}
                    <TickerTape />
                    
                    <nav className="bg-slate-900 border-b border-slate-800 p-4 rounded-t-xl flex flex-col md:flex-row justify-between items-center gap-4 mt-2">
                        <div className="flex items-center gap-2"><div className="bg-blue-600 p-2 rounded-lg text-white"><Icons.Target /></div><div><h1 className="text-xl font-bold text-white tracking-wide">Crypto Sniper Pro</h1><p className="text-xs text-slate-400">å®è§‚æˆ˜ç•¥ç‰ˆ v6.4</p></div></div>
                        <div className="flex items-center gap-4">
                            <FearGreedBadge /> {/* ææ…ŒæŒ‡æ•° (é›†æˆåœ¨Nav) */}
                            <SessionClock />
                            <div className="flex gap-2 text-xs"><a href="https://www.coinglass.com/zh/pro/futures/OpenInterest" target="_blank" className="hidden lg:flex items-center gap-1 bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded border border-slate-700 transition"><Icons.TrendingUp /> OI</a></div>
                        </div>
                        <div className="flex gap-2 bg-slate-800 p-1 rounded-lg"><button onClick={() => setDirection('long')} className={`px-4 py-1.5 rounded font-bold text-sm transition ${direction === 'long' ? 'bg-green-600 text-white shadow-lg shadow-green-900/50' : 'text-slate-400 hover:text-white'}`}>åšå¤š</button><button onClick={() => setDirection('short')} className={`px-4 py-1.5 rounded font-bold text-sm transition ${direction === 'short' ? 'bg-red-600 text-white shadow-lg shadow-red-900/50' : 'text-slate-400 hover:text-white'}`}>åšç©º</button></div>
                    </nav>

                    <div className="flex flex-col lg:flex-row gap-4 mt-4 flex-1">
                        <div className="flex-1 flex flex-col gap-4">
                            <div className="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden shadow-2xl h-[600px] relative">
                                <div id="tradingview_chart" className="h-full w-full"></div>
                                <div className="absolute top-2 left-16 z-10">
                                    <select value={symbol} onChange={e => setSymbol(e.target.value)} className="bg-slate-900/90 text-white text-sm py-1 px-2 rounded border border-slate-600 outline-none hover:border-blue-500 cursor-pointer backdrop-blur">
                                        <optgroup label="ğŸ”¥ çƒ­é—¨åˆçº¦">
                                            <option value="BINANCE:BTCUSDT.P">BTC/USDT</option>
                                            <option value="BINANCE:ETHUSDT.P">ETH/USDT</option>
                                            <option value="BINANCE:SOLUSDT.P">SOL/USDT</option>
                                            <option value="BINANCE:DOGEUSDT.P">DOGE/USDT</option>
                                        </optgroup>
                                        <optgroup label="ğŸŒ å®è§‚é£å‘æ ‡">
                                            <option value="CAPITALCOM:DXY">ç¾å…ƒæŒ‡æ•° (å®æ—¶CFD)</option>
                                            <option value="FOREXCOM:NAS100">çº³æ–¯è¾¾å…‹100 (CFD)</option>
                                            <option value="FOREXCOM:SPX500">æ ‡æ™®500 (CFD)</option>
                                            <option value="OANDA:XAUUSD">é»„é‡‘ (XAUUSD)</option>
                                            <option value="CRYPTOCAP:USDT.D">USDT å æ¯” (USDT.D)</option>
                                            <option value="CRYPTOCAP:BTC.D">BTC å¸‚å€¼å æ¯” (BTC.D)</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>
                            <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700/50 flex flex-col md:flex-row items-center justify-between gap-4">
                                <div className="flex items-center gap-2 text-slate-300 font-bold"><span className="text-blue-400"><Icons.Brain /></span> çµé­‚æ‹·é—®ï¼š</div>
                                <div className="flex gap-4 flex-wrap justify-center">{["æ‹’ç»æŠ¥å¤äº¤æ˜“", "å·²çœ‹DXYè„¸è‰²", "ç›ˆäºæ¯” > 1:2", "æ¥å—äºæŸ"].map((item, i) => (<label key={i} className="flex items-center gap-2 cursor-pointer select-none"><input type="checkbox" className="accent-blue-500 w-4 h-4" /><span className="text-sm text-slate-400">{item}</span></label>))}</div>
                            </div>
                        </div>

                        <div className="w-full lg:w-[400px] bg-slate-800 rounded-xl border border-slate-700 flex flex-col shadow-2xl h-[750px] lg:h-auto">
                            <div className="flex border-b border-slate-700">
                                {[
                                    { id: 'score', label: 'è¯„åˆ†', icon: <Icons.Target /> },
                                    { id: 'calc', label: 'é£æ§', icon: <Icons.Calculator /> },
                                    { id: 'plan', label: 'è®¡åˆ’ä¹¦', icon: <Icons.PenTool /> },
                                    { id: 'toolkit', label: 'å·¥å…·ç®±', icon: <Icons.Briefcase /> }
                                ].map(tab => (<button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 py-3 text-xs md:text-sm font-bold flex items-center justify-center gap-1 transition ${activeTab === tab.id ? 'text-blue-400 bg-slate-700/50 border-b-2 border-blue-400' : 'text-slate-500 hover:text-slate-300'}`}>{tab.icon} {tab.label}</button>))}
                            </div>

                            <div className="flex-1 overflow-y-auto p-4 no-scrollbar">
                                {activeTab === 'score' && (
                                    <div className="space-y-6 animate-fade-in">
                                        <div className={`p-4 rounded-xl border-2 ${rec.border} bg-slate-900/50 flex flex-col items-center text-center transition-all duration-300`}>
                                            <div className="text-xs text-slate-400 uppercase tracking-widest mb-1">Total Score</div>
                                            <div className={`text-5xl font-black font-mono mb-2 ${rec.color}`}>{totalScore}</div>
                                            <div className={`text-lg font-bold ${rec.color}`}>{rec.text}</div>
                                            <div className="text-xs text-slate-500 mt-2 bg-slate-800 px-3 py-1 rounded-full">{rec.action}</div>
                                        </div>
                                        <div className="space-y-4">
                                            {[
                                                { id: 'trend', title: '1. å¤©æ—¶ (è¶‹åŠ¿)', items: [{ k: 'ma99', t: `å‘¨çº¿EMA99${direction==='long'?'ä¹‹ä¸Š':'ä¹‹ä¸‹'}`, s: 200 }, { k: 'ma_align', t: 'æ—¥çº¿EMAå®Œç¾æ’åˆ—', s: 100 }, { k: 'dow', t: 'ç»“æ„ç ´å/å»¶ç»­', s: 80 }]},
                                                { id: 'location', title: '2. åœ°åˆ© (ä½ç½®)', items: [{ k: 'fib', t: 'å›è¸©/åæŠ½ 0.618', s: 150 }, { k: 'ma_touch', t: 'è§¦ç¢°æ—¥çº¿EMAå‡çº¿', s: 100 }, { k: 'vpvr', t: 'VPVRç­¹ç å¯†é›†åŒº', s: 50 }]},
                                                { id: 'signal', title: '3. äººå’Œ (ä¿¡å·)', items: [{ k: 'divergence', t: 'RSI/CVD èƒŒç¦»', s: 80 }, { k: 'pattern', t: 'Kçº¿å½¢æ€ç¡®è®¤', s: 60 }, { k: 'oi', t: 'æŒä»“é‡(OI)é…åˆ', s: 60 }]},
                                                { id: 'macro', title: '4. å¤©æœº (å®è§‚)', items: [{ k: 'fed', t: 'åŠ æ¯/é™æ¯é¢„æœŸåˆ©å¥½', s: 80 }, { k: 'funding', t: 'èµ„é‡‘è´¹ç‡ä¼˜åŠ¿', s: 40 }]}
                                            ].map(section => (
                                                <div key={section.id} className="bg-slate-700/30 rounded-lg p-3 border border-slate-700">
                                                    <h4 className="text-xs font-bold text-slate-400 mb-2 uppercase">{section.title}</h4>
                                                    <div className="space-y-2">{section.items.map(item => (<label key={item.k} className="flex items-center justify-between cursor-pointer group"><div className="flex items-center gap-2"><input type="checkbox" checked={scores[section.id][item.k]} onChange={() => handleCheck(section.id, item.k)} className="w-4 h-4 accent-blue-500 rounded bg-slate-800 border-slate-600" /><span className="text-sm text-slate-300 group-hover:text-white transition">{item.t}</span></div><span className="text-xs font-mono text-slate-500">+{item.s}</span></label>))}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'calc' && <div className="space-y-6"><div className="bg-slate-700/30 p-4 rounded-xl border border-slate-700"><h3 className="font-bold text-blue-400 mb-4 flex items-center gap-2"><Icons.ShieldAlert /> ä»“ä½å¤§å°è®¡ç®—å™¨</h3><PositionCalc direction={direction} score={totalScore} /></div><div className="bg-slate-700/30 p-4 rounded-xl border border-slate-700"><h3 className="font-bold text-green-400 mb-4 flex items-center gap-2"><Icons.Target /> ç›ˆäºæ¯”æ¨æ¼”</h3><RiskRewardCalc direction={direction} /></div></div>}
                                {activeTab === 'plan' && <BattlePlan score={totalScore} rec={rec} symbol={symbol} direction={direction} />}
                                {activeTab === 'toolkit' && <Toolkit />}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
